<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% if title %}{{ title }} Â· {% endif %}{{ site.name }}</title>
    {% if description %}<meta name="description" content="{{ description }}" />{% endif %}

    {% set canonicalUrl = page.url | absoluteUrl(site.url) %}
    <link rel="canonical" href="{{ canonicalUrl }}" />

    <meta property="og:site_name" content="{{ site.name }}" />
    <meta property="og:title" content="{% if title %}{{ title }}{% else %}{{ site.name }}{% endif %}" />
    {% if description %}<meta property="og:description" content="{{ description }}" />{% endif %}
    <meta property="og:url" content="{{ canonicalUrl }}" />
    <meta property="og:type" content="article" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="{% if title %}{{ title }}{% else %}{{ site.name }}{% endif %}" />
    {% if description %}<meta name="twitter:description" content="{{ description }}" />{% endif %}

    {% if image %}
      {% set imageAbs = image | absoluteUrl(site.url) %}
      <meta property="og:image" content="{{ imageAbs }}" />
      <meta name="twitter:image" content="{{ imageAbs }}" />
    {% endif %}

    <script>
      (function () {
        try {
          var saved = localStorage.getItem("theme");
          var theme = (saved === "light" || saved === "dark")
            ? saved
            : (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");
          document.documentElement.setAttribute("data-theme", theme);
        } catch (e) {
          document.documentElement.setAttribute("data-theme", "light");
        }
      })();
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Lora:wght@400;600&family=Source+Code+Pro:wght@400;500&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="/assets/styles.css" />
  </head>
  <body class="{% if layoutClass %}{{ layoutClass }}{% endif %}{% if layout == 'layouts/post.njk' %} is-post-page{% endif %}">
    <a href="#content" class="skip-link">Skip to content</a>

    {% if page.url and (page.url.substring(0,6) == '/blog/' or page.url == '/sys_link/') %}
      <a href="{% if page.url == '/blog/' or page.url == '/sys_link/' %}/{% else %}/blog/{% endif %}" class="back-button" aria-label="Go back">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M15 18l-6-6 6-6"/>
        </svg>
      </a>
    {% endif %}

    <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
      <span class="theme-icon"></span>
    </button>

    {% include "partials/header.njk" %}

    <main class="container" id="content">
      {{ content | safe }}
    </main>

    {% include "partials/footer.njk" %}

    <script>
      (function () {
        var btn = document.getElementById("theme-toggle");
        if (!btn) return;
        var icon = btn.querySelector(".theme-icon");

        var sun = '<svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="M20 12h2"></path><path d="M2 12H4"></path><path d="M17.66 6.34l1.42-1.42"></path><path d="M4.92 19.07l1.41-1.41"></path><path d="M17.66 17.66l1.42 1.42"></path><path d="M4.92 4.93l1.41 1.41"></path></svg>';
        var moon = '<svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path></svg>';

        function currentTheme() {
          return document.documentElement.getAttribute("data-theme") || "light";
        }

        function setTheme(next) {
          document.documentElement.setAttribute("data-theme", next);
          try { localStorage.setItem("theme", next); } catch (e) {}
          if (icon) icon.innerHTML = next === "dark" ? moon : sun;
          btn.setAttribute("aria-label", next === "dark" ? "Switch to light mode" : "Switch to dark mode");
        }

        setTheme(currentTheme());
        btn.addEventListener("click", function () {
          setTheme(currentTheme() === "dark" ? "light" : "dark");
        });
      })();
    </script>
  </body>
</html>
