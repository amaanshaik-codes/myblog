<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    {% if layoutClass == 'is-hermes-page' %}
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content" />
    {% else %}
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    {% endif %}
    {% if title %}
      {% if titleOnly %}
        <title>{{ title }}</title>
      {% else %}
        <title>{{ title }} Â· {{ site.name }}</title>
      {% endif %}
    {% else %}
      <title>{{ site.name }}</title>
    {% endif %}
    {% if description %}<meta name="description" content="{{ description }}" />{% endif %}

    {% set canonicalUrl = page.url | absoluteUrl(site.url) %}
    <link rel="canonical" href="{{ canonicalUrl }}" />

    <meta property="og:site_name" content="{{ site.name }}" />
    <meta property="og:title" content="{% if title %}{{ title }}{% else %}{{ site.name }}{% endif %}" />
    {% if description %}<meta property="og:description" content="{{ description }}" />{% endif %}
    <meta property="og:url" content="{{ canonicalUrl }}" />
    <meta property="og:type" content="article" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="{% if title %}{{ title }}{% else %}{{ site.name }}{% endif %}" />
    {% if description %}<meta name="twitter:description" content="{{ description }}" />{% endif %}

    {% if image %}
      {% set imageAbs = image | absoluteUrl(site.url) %}
      <meta property="og:image" content="{{ imageAbs }}" />
      <meta name="twitter:image" content="{{ imageAbs }}" />
    {% endif %}

    <script>
      (function () {
        try {
          var saved = localStorage.getItem("theme");
          var theme = (saved === "light" || saved === "dark") ? saved : "dark";
          document.documentElement.setAttribute("data-theme", theme);
        } catch (e) {
          document.documentElement.setAttribute("data-theme", "dark");
        }
      })();
    </script>

    <link rel="dns-prefetch" href="https://chat.openai.com" />
    <link rel="preload" as="image" href="/assets/myface-185.webp" type="image/webp" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- Favicon / Touch Icon (prefer WEBP, fall back to PNG) -->
    <link rel="icon" href="/assets/favicon-32.webp" sizes="32x32" type="image/webp" />
    <link rel="icon" href="/assets/favicon-32.png" sizes="32x32" type="image/png" />
    <link rel="icon" href="/assets/favicon-16.webp" sizes="16x16" type="image/webp" />
    <link rel="icon" href="/assets/favicon-16.png" sizes="16x16" type="image/png" />
    <link rel="apple-touch-icon" href="/assets/apple-touch-icon-180.webp" sizes="180x180" />
    <link rel="apple-touch-icon" href="/assets/apple-touch-icon-180.png" sizes="180x180" />
    <link rel="manifest" href="/assets/manifest.json" />
    <meta name="theme-color" content="#0f0f0f" />

    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600&family=Libertinus+Serif:ital@0;1&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet" />
    <link rel="alternate" type="application/rss+xml" title="{{ site.name }}" href="/feed.xml" />
    <link rel="stylesheet" href="/assets/styles.css" />
  </head>
  <body class="{% if layoutClass %}{{ layoutClass }}{% endif %}{% if layout == 'layouts/post.njk' %} is-post-page{% endif %}">
    <a href="#content" class="skip-link">Skip to content</a>

    {% if page.url and (page.url.substring(0,6) == '/blog/' or page.url == '/sys_link/' or page.url == '/hermes/') %}
      <a href="{% if page.url == '/blog/' or page.url == '/sys_link/' or page.url == '/hermes/' %}/{% else %}/blog/{% endif %}" class="back-button" aria-label="Go back" title="(Back)">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
          <path d="M15 18l-6-6 6-6"/>
        </svg>
      </a>
    {% endif %}

    <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
      <span class="theme-icon" aria-hidden="true"></span>
    </button>

    {% include "partials/header.njk" %}

    <main class="container" id="content">
      {{ content | safe }}
    </main>

    {% include "partials/footer.njk" %}

    <script src="/assets/font-loader.js" defer></script>
    <script src="/assets/theme.js" defer></script>
    <script src="/assets/stamp-tooltip.js" defer></script>
    <script src="/assets/voicenote-player.js" defer></script>
  </body>
</html>
